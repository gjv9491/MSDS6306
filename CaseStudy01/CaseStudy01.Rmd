---
title: " Understanding the relationship between Income group and GDP."
subtitle: "Using World Bank Education Stats to Gross Domestic Product data"
author: "Gino Varghese"
date: "October 25, 2016"
output: 
  html_document:
    keep_md: true
---

## Introdution
<br>     

#### For this analysis we will look at two different data sets      

* First set of data contains Gross Domestic Product which is comprised of 2012 GDP values for 190 countries throughout the world. More recent data is hosted on Worldbank.org.     
    + http://data.worldbank.org/data-catalog/GDP-ranking-table
* Second contains World Bank Education Stats data.       
    + http://data.worldbank.org/data-catalog/ed-stats
<br>

Our goal is to make some educated assumptions by combining both the data sets, to see if there is any relationship between the access to education, progression, completion, literacy, teachers, population, and expenditures boost's the countries income growth which will then lead to countries economic growth.

<br>
<br>

#### Before we start our analysis, we set the following:                

* set working directory          
* install necessary packages       
* R version     

```{r setup, include=TRUE, message=FALSE, echo=TRUE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = "~/git/MSDS6306/CaseStudy01/Analysis/Data")
require(knitr)
require(dplyr)
require(plyr)
require(ggplot2)
require(downloader)
require(countrycode)
sessionInfo()
```

<br>
<br>

#### Now to start our analysis we need to first download the data sets        

* **Gross Domestic Product download**         
    + This process downloads Gross Domestic Product data sets and renames it as "GDPbyCountry.csv"     
    + Downloaded file are listed below in Data directory        
```{r gdpdownload, cache=TRUE,echo=TRUE}
source("downloadGDP.R", echo = TRUE)
list.files()
```        

<br>        

* **Education data download**      
    + This process downloads Education data set and renames it as "EDUbyCountry.csv"          
    + Downloaded file are listed below  in Data directory         
```{r edudownload, cache=TRUE, echo=TRUE}
source("downloadEDU.R", echo = TRUE)
list.files()
```

<br>
<br>         

##### Once the data is dowloaded to the projects "Data"  directory, it is ready to be imported into the R as a data frame. Once importation, the data frame is observed for internal structure details and beginning and ending rows, to determine what actions should be taken when tidying the data.        
<br>          

* **Gross Domestic Product is loaded into R**        
    + The csv file is loaded into **Rawgdp** data frame          
        + the data frame is reviewed by using R commands such as: head, tail and str        
    + The **Rawgdp** is then loaded into **GDP** data frame to begin the tidying process          
    + **Tidying process**            
        + We modified the **GDP** data frame as follows:
            + V[n] column headers are removed        
            + Unwanted space between column header and data is removed    
            + Empty columns with no data are removed
            + column names are renamed to lower case
            + "us dollars)" column name is renamed to us.dollars
            + ISO3.CountryCode are generated for each row and stored in iso3.countrycode
                + using countrycode package     
            + "Kosovo", "Channel Islands" and "Sodom and Principe" iso3 country codes are added to the data set
            + The us.dollars column is converted into numeric, removing "," from the dollars and "NA" rows are converted to "0"
            + Rows that are not related to any countries are moved to another data frame **GDPNoCountryCode**      
                + these data sets are also removed from **GDP** data frame     
            + The final rows for each data frame are as follows:
                + Raw GDP file : 331 rows      
                + GDP data with NA : 112 rows      
                + Tidy GDP data : 214 rows  
    + Tidy data is then written to **"GDP_Final.csv"** file, to facilitate analysis.
                

```{r gdploadandreview, cache=TRUE, echo=TRUE}
source("Cleanup_GDP.R", echo = TRUE)

```

<br>          

* **World Bank EdStats is loaded into R**        
    + The csv file is loaded into **Rawedu** data frame          
        + the data frame is reviewed by using R commands such as: head, tail and str        
    + The **Rawedu** is then loaded into **EDU** data frame to begin the tidying process          
    + **Tidying process**           
        + We modified the **EDU** data frame as follows:
            + V[n] column headers are removed        
            + Unwanted space between column header and data is removed    
            + Empty columns with no data are removed
            + column names are renamed to lower case
            + ISO3.CountryCode are generated for each row and stored in iso3.countrycode
                + using countrycode package     
            + "Kosovo", "Channel Islands" and "Sodom and Principe" iso3 country codes are added to the data set
            + Rows that are not related to any countries are moved to another data frame **EDUNoCountryCode**      
                + these data sets are also removed from **EDU** data frame     
            + The final rows for each data frame are as follows:
                + Raw EDU file : 331 rows      
                + EDU data with NA : 23 rows      
                + Tidy EDU data : 211 rows  
    + Tidy data is then written to **"EDU_Final.csv"** file, to facilitate analysis.
                

```{r eduloadandreview, cache=TRUE, echo=TRUE}
source("Cleanup_EDU.R", echo = TRUE)

```

<br>                                      
                                      
* **Clearing existing objects**
```{r cleanobj, cache=TRUE, echo=TRUE}
source("removeObjects.R", echo = TRUE)

```
             
<br>

* **Loading tidy data for analysis**
```{r tidydata, cache=TRUE, echo=TRUE}
#Load cleaned up csv file for GDP

#setwd("~/git/MSDS6306/CaseStudy01/Analysis")
gdppath <- "GDP_Final.csv"
edupath <- "EDU_Final.csv"

#load and 
GDP <- read.csv(gdppath,header=TRUE)
names(GDP)[names(GDP)=="X"] <- "ID"
str(GDP)

EDU <- read.csv(edupath,header=TRUE)
names(EDU)[names(EDU)=="X"] <- "ID"
str(EDU)

```
<br>
<br>

#### Merging GDP and EDU data
The original data have been cleaned and only the columns of interest have been set aside for merging, GDP and EDU data are ready to be merged together. After merging the two data sets together by *iso3.countrycode*
```{r mergeGDPEDU, cache=TRUE, echo=FALSE}
MergeGDPInc <- merge(EDU, GDP, by = "iso3.countrycode", all = TRUE)

```     

<br>

#### Reduce to columns of interest       
* iso3.countrycode
* "economy"
* "ranking"
* "income group"
* "us.dollars"      

```{r columnsinterest, cache=TRUE, echo=TRUE}
names(MergeGDPInc)[names(MergeGDPInc)=="iso3.countrycode"] <- "country.code"
names(MergeGDPInc)[names(MergeGDPInc)=="economy"] <- "country.name"
names(MergeGDPInc)[names(MergeGDPInc)=="ranking"] <- "gdp.ranking"
names(MergeGDPInc)[names(MergeGDPInc)=="income group"] <- "income.group"
names(MergeGDPInc)[names(MergeGDPInc)=="us.dollars"] <- "gdp.usd"

MergeGDPInc <- subset(MergeGDPInc,select = c("country.code","country.name","gdp.ranking","income.group","gdp.usd"))

str(MergeGDPInc)
```          
            
<br>
<br>

### Results:

#### **Question 1:** Match the data based on the country shortcode. How many of the IDs match?
<br>
```{r NA, cache=TRUE, echo=TRUE}
## how many of the IDs match?
nrow(MergeGDPInc)

## how many of the rows contain NAs?
sum(!complete.cases(MergeGDPInc))

## Remove rows with missing data
MergeGDPInc01 <- MergeGDPInc[complete.cases(MergeGDPInc),]
nrow(MergeGDPInc01) 
str(MergeGDPInc01)
```        

##### **There are 215 matching IDs. Once all 26 NAs are removed, there remain 189 matching country code IDs.**       

<br>
<br>

#### **Question 2:** Sort the data frame in ascending order by GDP (so United States is last). What is the 13th country in the resulting data frame?
<br>
```{r sortorder, cache=TRUE, echo=TRUE}
MergeGDPInc01 <- MergeGDPInc01[order(MergeGDPInc01$gdp.usd, decreasing = FALSE),] # Sort the data by GDP
MergeGDPInc01$country.name[13]
``` 
                   
##### **St. Kitts and Nevis is the 13th country in the data frame**            

<br>
<br>

#### **Question 3:** What are the average GDP rankings for the "High income: OECD" and "High income: nonOECD" groups?
<br>
```{r gdpranking, cache=TRUE, echo=TRUE}
mean(subset(MergeGDPInc01, income.group == "High income: OECD")$gdp.ranking)    # Mean High income: OECD rank
mean(subset(MergeGDPInc01, income.group == "High income: nonOECD")$gdp.ranking) # Mean High income: nonOECD rank
```      
       
##### **Average *High income: OECD* GDP ranking is 32.96667.**
##### **Average *High income: nonOECD* GDP ranking is 91.91304.**

<br>
<br>

#### **Question 4:** Plot the GDP for all of the countries. Use ggplot2 to color your plot by Income.Group?
<br>
```{r [gdprankingplotgdp, cache=TRUE, echo=TRUE}
 ggplot(data = MergeGDPInc01, aes(x=income.group, y=(gdp.usd/10000), fill=income.group)) + 
  geom_boxplot(outlier.colour = "red", outlier.shape = 8, outlier.size = 2) +
  ggtitle("GDP for All Countries by Income Group") +
  labs(x="Income Group", y="(GDP/10,000) (US Dollars in Millions)") + theme(text = element_text(size=12),
        axis.text.x = element_text(angle=90, vjust=1)) 
``` 
                         
##### **The first boxplot visualization depicts all *GDP (US Dollars in million)* data by *Income Group*.**             

##### **The data appears heavily skewed and large outliers in *High income: OECD* and *Lower middle income* make it difficult to compare each distribution by *Income.Group*. Its best to log transform the data and then visualize the box plots**        
<br>
```{r [gdprankingplotgdplog, cache=TRUE, echo=TRUE}
 ggplot(data = MergeGDPInc01, aes(x=income.group, y=log(gdp.usd/10000), fill=income.group)) + 
  geom_boxplot(outlier.colour = "red", outlier.shape = 8, outlier.size = 2) +
  ggtitle("Log of GDP for All Countries by Income Group") +
  labs(x="Income Group", y="Log of GDP (US Dollars in Millions)") + theme(text = element_text(size=12),
        axis.text.x = element_text(angle=90, vjust=1)) 
``` 
<br>      

##### **As soon as the data was log transformed, it was evident that most of the *High income: OECD* group data exceed the remaining groups' data in terms of GDP, It appears that *High income: nonOECD's* appears to be nearly identical to *Upper middle income's* **

<br>
<br>

#### **Question 5:** Cut the GDP ranking into 5 separate quantile groups. Make a table versus Income.Group. How many countries are lower middle income but among the 38 nations with the highest GDP?
##### *ntile* function is used to split the GDP rankings into 5 separate quantile groups, this function is from the *dplyr* package. 
<br>
```{r [gdprankingby5, cache=TRUE, echo=TRUE}
MergeQuantile <- MergeGDPInc01
MergeQuantile$gdp.quantile <- ntile(MergeQuantile$gdp.ranking, 5) # Add 5 quantiles by Country.Rank to new GDP.Quantile column

## Generate table by Income.Group output
table(MergeQuantile$income.group, MergeQuantile$gdp.quantile, dnn = c("Income.Group","GDP.Quantile"))

## Confirm number of lower middle income countries as listed in the table above
sum(MergeQuantile[(nrow(MergeQuantile)-37):nrow(MergeQuantile),]$income.group == "Lower middle income")

```
<br>          

##### **Based on the groupings, *Lower middle income* group are among the 38 nations with the highest GDP, especially 5 countries.**       

<br>
<br>
<br>       

#### Conclusion:      

